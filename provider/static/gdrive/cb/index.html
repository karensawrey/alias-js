<html>
    <head>
        <title>Please wait</title>

        <script type="application/javascript" src="/jquery-3.4.1.min.js"></script>
        <script type="application/javascript" src="/header.js"></script>
        <script type="application/javascript" src="/sodium.js"></script>
        <script type="application/javascript" src="/anychain.js"></script>
        <script type="application/javascript" src="/alias.js"></script>

    </head>
    <body>
        <h1>Please wait...</h1>
        <p>You'll be redirected soon.</p>
    <script>
        function run() {
            const url = new URL(window.location.href);
            let token = url.searchParams.get("token");
            if (!token) {
                alert("no token were returned!");
            }

            try {
                token = JSON.parse(token);
            } catch(e) {
                alert("bad token format");
            }

            let pwh = currentPwh();
            if (!pwh) {
                alert("session were closed");
            }

            mutateBox(pwh, function(box) {
                box.gdrive = { token: token };
            });

            console.log(openBox(pwh));

            window.location.href = "/";
        };
    </script>
    </body>
</html>
